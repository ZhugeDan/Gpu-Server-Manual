------

# 📘 实验室 GPU 服务器管理员手册 (LXD版)

## 1. 新生入驻流程 (标准作业程序)

每当有新同学（例如：王五 `wangwu`）来申请账号时，请按此流程操作：

**第一步：在宿主机 (Host) 创建容器**

Bash

```
# 1. 从“始祖巨人”复制新容器
lxc init founding-titan wangwu

# 2. 分配所有显卡 (推荐策略)
lxc config device add wangwu gpu gpu

# 3. 分配 SSH 端口 (核心！不可重复)
# 假设王五是 10003 (建议做个 Excel 表格记录每个人对应的端口)
lxc config device add wangwu ssh-proxy proxy listen=tcp:0.0.0.0:10003 connect=tcp:127.0.0.1:22

# 4. (可选) 限制资源防止撑爆服务器
    lxc config set wangwu limits.memory 64GB
lxc config set wangwu limits.cpu 16

# 5. 启动容器
lxc start wangwu
```

**第二步：配置用户与密码**

Bash

```
# 1. 进入容器
lxc exec wangwu bash

# 2. 容器内操作
useradd -m -s /bin/bash wangwu  # 建号
passwd wangwu                   # 设密码 (输两遍)
usermod -aG sudo wangwu         # 给管理员权限
exit                            # 退出
```

**第三步：发送给同学的信息**

> - **IP:** `192.168.137.203` (换成你的实际 IP)
> - **Port:** `10003`
> - **User:** `wangwu`
> - **连接命令:** `ssh wangwu@192.168.137.203 -p 10003`

------

## 2. 日常管理命令 (宿主机端)

**查看所有容器状态** (每天看一眼)

Bash

```
lxc list
```

- *关注 IPV4 是否有值，STATE 是否为 RUNNING。*

**容器的启停**

Bash

```
lxc stop zhangsan      # 强制关机 (同学跑死循环时用)
lxc start zhangsan     # 开机
lxc restart zhangsan   # 重启
lxc delete zhangsan    # 删库跑路 (慎用！删了就找不回了)
```

**查看资源占用 (查内鬼)**

Bash

```
# 查看宿主机整体负载 (CPU/内存)
htop

# 查看显卡实时占用 (看是谁在跑代码)
watch -n 1 nvidia-smi
```

------

## 3. 文件管理与传输

场景 A：同学想从自己电脑传文件进去 (最常用)

告诉同学在他们自己的 PowerShell 里用 SCP：

PowerShell

```
# 传文件到服务器
scp -P 10001 本地文件.zip zhangsan@192.168.137.203:~/

# 从服务器下载文件
scp -P 10001 zhangsan@192.168.137.203:~/结果.csv ./
```

场景 B：你是管理员，你想直接塞文件给同学

你不需要密码，可以直接用 LXD 塞进去：

Bash

```
# 从宿主机把 data.zip 塞给 zhangsan 的家目录
lxc file push data.zip zhangsan/home/zhangsan/

# 把 zhangsan 的作业拿出来
lxc file pull zhangsan/home/zhangsan/homework.py ./
```

------

## 4. 故障急救箱 (Troubleshooting)

情况 1：容器突然没网了 / 没 IP 了

症状：lxc list 里 IPV4 是空的，或者同学喊连不上。

解决： 重启 LXD 的网络服务。

Bash

```
sudo snap restart lxd
# 等几秒后
lxc restart <容器名>
```

情况 2：显卡突然看不到了

症状：输入 nvidia-smi 报错。

解决： 这是一个玄学问题，通常是因为内核更新了。

Bash

```
sudo reboot
# 重启是解决 90% 硬件问题的良药
```

情况 3：宿主机连不上网了

症状：宿主机 ping baidu.com 不通。

解决： 检查物理网线，或者强制唤醒网卡 (你之前用过的那招)。

Bash

```
sudo ip link set eno1 up
sudo dhclient eno1
```

------

## 5. 维护与更新 (长期)

**宿主机系统更新 (一个月一次)**

Bash

```
sudo apt update && sudo apt upgrade -y
```

- *注意：如果更新了内核 (linux-image)，记得重启服务器。*

备份容器 (快照)

如果张三要做高危操作，先给他拍个快照，坏了能回滚。

Bash

```
# 创建快照
lxc snapshot zhangsan snap01

# 恢复快照 (时光倒流)
lxc restore zhangsan snap01
```

------

